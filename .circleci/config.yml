version: 2.1

jobs:
  deploy_app_to_railway:
    docker:
      - image: cimg/node:20.9
    working_directory: ~/project
    steps:
      - checkout
      - run: sudo npm i -g @railway/cli
      - run: railway --version
      - run: |
          if [ -z "$RAILWAY_TOKEN" ]; then
            echo "RAILWAY_TOKEN no estÃ¡ definido en CircleCI > Project Settings > Environment Variables" && exit 1
          fi
          railway login --token "$RAILWAY_TOKEN"
      - run: |
          railway link -p 0dfaa7e7-3371-47fa-b70d-7e8b103c3614
          cd bankchurn-api
          railway up --service "bountiful-grace" --detach

workflows:
  deploy:
    jobs:
      - deploy_app_to_railway:
          filters:
            branches:
              only: main
